!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MediumEditorInsert=t():e.MediumEditorInsert=t()}(this,function(){return function(e){function t(n){if(i[n])return i[n].exports;var s=i[n]={exports:{},id:n,loaded:!1};return e[n].call(s.exports,s,s.exports,t),s.loaded=!0,s.exports}var i={};return t.m=e,t.c=i,t.p="",t(0)}([function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var s=i(2),o=n(s),a=MediumEditor.Extension.extend({name:"insert",addons:{images:!0,embeds:!0},init:function(){MediumEditor.Extension.prototype.init.apply(this,arguments),this.core=new o["default"](this)},destroy:function(){this.core.removeButtons()}});t["default"]=a,e.exports=t["default"]},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={ucfirst:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},generateRandomString:function(){var e=arguments.length<=0||void 0===arguments[0]?15:arguments[0];return Math.random().toString(36).substr(2,e+2)},getClosestWithClassName:function(e,t){return MediumEditor.util.traverseUp(e,function(e){return e.classList.contains(t)})}},e.exports=t["default"]},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(1),u=n(a),l=i(4),r=n(l),d=i(3),c=n(d),f=function(){function e(t){s(this,e),this._plugin=t,this._editor=this._plugin.base,this.initAddons(),this.addButtons(),this.events()}return o(e,[{key:"events",value:function(){var e=this,t=void 0;this._plugin.on(document,"click",this.toggleButtons.bind(this)),this._plugin.on(document,"keyup",this.toggleButtons.bind(this)),this._plugin.on(this.buttons.getElementsByClassName("medium-editor-insert-buttons-show")[0],"click",this.toggleAddons.bind(this)),t=this.buttons.getElementsByClassName("medium-editor-insert-action"),Array.prototype.forEach.call(t,function(t){e._plugin.on(t,"click",e.handleAddonClick.bind(e))}),this._plugin.on(window,"resize",this.positionButtons.bind(this))}},{key:"initAddons",value:function(){var e=this;this._plugin.initializedAddons={images:new r["default"](this._plugin,this._plugin.addons.images),embeds:new c["default"](this._plugin,this._plugin.addons.embeds)},Object.keys(this._plugin.addons).forEach(function(t){var i=e._plugin.addons[t];if(!e._plugin.initializedAddons[t]&&i){var n="MediumEditorInsert"+u["default"].ucfirst(t);window[n]?e._plugin.initializedAddons[t]=new window[n](e._plugin,i):window.console.error('Addon "'+t+"\" couldn't be found!")}i||delete e._plugin.initializedAddons[t]})}},{key:"addButtons",value:function(){var e=this,t=void 0;this.buttons=document.createElement("div"),this.buttons.id="medium-editor-insert-"+this._plugin.getEditorId(),this.buttons.classList.add("medium-editor-insert-buttons"),this.buttons.setAttribute("contentediable",!1),t='<a class="medium-editor-insert-buttons-show">+</a>\n            <ul class="medium-editor-insert-buttons-addons">',Object.keys(this._plugin.initializedAddons).forEach(function(i){var n=e._plugin.initializedAddons[i];t+='<li><a class="medium-editor-insert-action" data-addon="'+i+'">'+n.label+"</a></li>"}),t+="</ul>",this.buttons.innerHTML=t,document.body.appendChild(this.buttons)}},{key:"removeButtons",value:function(){this.buttons.remove()}},{key:"positionButtons",value:function(){var e=void 0,t=void 0,i=void 0,n=void 0,s=void 0,o=void 0,a=void 0;this.buttons.classList.contains("medium-editor-insert-buttons-active")!==!1&&(e=this._editor.getSelectedParentElement(),t=e.getBoundingClientRect(),i=this.buttons.getElementsByClassName("medium-editor-insert-buttons-addons")[0],n=this.buttons.getElementsByClassName("medium-editor-insert-action")[0],s=window.getComputedStyle(i),o=window.getComputedStyle(n),a={top:window.scrollY+t.top,left:window.scrollX+t.left-parseInt(s.left,10)-parseInt(o.marginLeft,10)},a.left=a.left<0?t.left:a.left,this.buttons.style.left=a.left+"px",this.buttons.style.top=a.top+"px")}},{key:"toggleButtons",value:function(){var e=this._editor.getSelectedParentElement();this.shouldDisplayButtonsOnElement(e)?(this.selectElement(e),this.showButtons()):(this.deselectElement(),this.hideButtons())}},{key:"shouldDisplayButtonsOnElement",value:function(e){var t=this,i=[],n=!1;return""!==e.innerText.trim()?!1:(Object.keys(this._plugin.initializedAddons).forEach(function(e){var n=t._plugin.initializedAddons[e];n.elementClassName&&i.push(n.elementClassName)}),i.forEach(function(t){return e.classList.contains(t)||u["default"].getClosestWithClassName(e,t)?void(n=!0):void 0}),!n)}},{key:"selectElement",value:function(e){this.selectedElement=e}},{key:"deselectElement",value:function(){this.selectedElement=null}},{key:"showButtons",value:function(){this.buttons.classList.add("medium-editor-insert-buttons-active"),this.positionButtons()}},{key:"hideButtons",value:function(){this.buttons.classList.remove("medium-editor-insert-buttons-active"),this.buttons.classList.remove("medium-editor-insert-addons-active")}},{key:"toggleAddons",value:function(){this.buttons.classList.toggle("medium-editor-insert-addons-active")}},{key:"handleAddonClick",value:function(e){var t=e.currentTarget.getAttribute("data-addon");e.preventDefault(),this._plugin.initializedAddons[t].handleClick(e)}}]),e}();t["default"]=f,e.exports=t["default"]},function(e,t){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),s=function(){function e(t,n){i(this,e),this._plugin=t,this._editor=this._plugin.base,this.options={label:'<span class="fa fa-youtube-play"></span>'},Object.assign(this.options,n),this.label=this.options.label}return n(e,[{key:"handleClick",value:function(){window.console.log("embeds clicked")}}]),e}();t["default"]=s,e.exports=t["default"]},function(e,t,i){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(1),u=n(a),l=function(){function e(t,i){s(this,e),this.options={label:'<span class="fa fa-camera"></span>',preview:!0,uploadUrl:"upload.php"},Object.assign(this.options,i),this._plugin=t,this._editor=this._plugin.base,this.elementClassName="medium-editor-insert-images",this.label=this.options.label,this.events()}return o(e,[{key:"events",value:function(){var e=this;this._plugin.on(document,"click",this.unselectImage.bind(this)),this._plugin.getEditorElements().forEach(function(t){e._plugin.on(t,"click",e.selectImage.bind(e))})}},{key:"handleClick",value:function(){this._input=document.createElement("input"),this._input.type="file",this._input.multiple=!0,this._plugin.on(this._input,"change",this.uploadFiles.bind(this)),this._input.click()}},{key:"uploadFiles",value:function(){var e=this,t=this._plugin.core.selectedElement;if("p"===t.nodeName.toLowerCase()){var i=document.createElement("div");t.parentNode.insertBefore(i,t),this._plugin.core.selectElement(i),t.remove()}Array.prototype.forEach.call(this._input.files,function(t){var i=u["default"].generateRandomString();e.options.preview&&e.preview(t,i),e.upload(t,i)}),this._plugin.core.hideButtons()}},{key:"preview",value:function(e,t){var i=this,n=new FileReader;n.onload=function(e){i.insertImage(e.target.result,t)},n.readAsDataURL(e)}},{key:"upload",value:function(e,t){var i=this,n=new XMLHttpRequest,s=new FormData;n.open("POST",this.options.uploadUrl,!0),n.onreadystatechange=function(){if(4===n.readyState&&200===n.status){var e=i._plugin.core.selectedElement.querySelector('[data-uid="'+t+'"]');e?i.replaceImage(e,n.responseText):i.insertImage(n.responseText)}},s.append("file",e),n.send(s)}},{key:"insertImage",value:function(e,t){var i=this._plugin.core.selectedElement,n=document.createElement("figure"),s=document.createElement("img");s.src=e,s.alt="",t&&s.setAttribute("data-uid",t),n.appendChild(s),i.classList.add(this.elementClassName),i.appendChild(n)}},{key:"replaceImage",value:function(e,t){e.src=t,e.removeAttribute("data-uid")}},{key:"selectImage",value:function(e){var t=e.target;"img"===t.nodeName.toLowerCase()&&u["default"].getClosestWithClassName(t,this.elementClassName)&&t.classList.add("medium-editor-insert-image-active")}},{key:"unselectImage",value:function(e){var t=e.target,i=void 0;"img"===t.nodeName.toLowerCase()&&t.classList.contains("medium-editor-insert-image-active")&&(i=t),this._plugin.getEditorElements().forEach(function(e){var t=e.getElementsByClassName("medium-editor-insert-image-active");Array.prototype.forEach.call(t,function(e){e!==i&&e.classList.remove("medium-editor-insert-image-active")})})}}]),e}();t["default"]=l,e.exports=t["default"]}])});
//# sourceMappingURL=medium-editor-insert.min.js.map